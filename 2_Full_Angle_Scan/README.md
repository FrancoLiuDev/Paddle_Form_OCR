# 全角度掃描工具

使用 Bresenham 演算法對圖像進行全角度掃描，找出空白率最高的最佳角度。

## 功能特點

- **全角度掃描**: 測試指定角度範圍內的所有角度
- **自動找出最佳角度**: 根據空白率自動排序並顯示前 N 個最佳角度
- **Bresenham 演算法**: 使用像素精確的掃描算法
- **可視化輸出**: 可選擇生成最佳角度的掃描線可視化圖像
- **詳細統計**: 顯示每個角度的掃描線數、空白線數、空白率、白色點率等

## 使用方法

### 基本用法

```bash
# 掃描 -90° 到 90° 的所有角度（每 1° 一次）
python3 full_angle_scan.py --input ../fuji3.png

# 指定角度範圍和步進
python3 full_angle_scan.py --input ../fuji3.png --angle-start -30 --angle-end 30 --angle-step 0.5

# 生成可視化圖像
python3 full_angle_scan.py --input ../fuji3.png --visualize --output best_result.jpg

# 顯示前 20 個最佳角度
python3 full_angle_scan.py --input ../fuji3.png --top-n 20

# 詳細模式（顯示每個角度的測試進度）
python3 full_angle_scan.py --input ../fuji3.png --verbose
```

### 參數說明

- `--input`: 輸入圖像路徑（必需）
- `--output`: 輸出圖像路徑（預設: `best_angle.jpg`）
- `--angle-start`: 起始角度（預設: `-90`）
- `--angle-end`: 結束角度（預設: `90`）
- `--angle-step`: 角度步進（預設: `1.0`）
- `--scan-step`: 掃描間隔，單位像素（預設: `5`）
- `--white-threshold`: 白色閾值（預設: `199`）
- `--top-n`: 顯示前 N 個最佳角度（預設: `10`）
- `--verbose`: 顯示詳細信息
- `--visualize`: 生成最佳角度的可視化圖像

## 輸出範例

```
======================================================================
全角度掃描測試
======================================================================
角度範圍: -90.0° 到 90.0°
角度步進: 1.0°
掃描間隔: 5 像素
白色閾值: 199
總共測試角度數: 181
======================================================================

測試角度  90.0° (181/181)...
======================================================================
掃描完成！
======================================================================

================================================================================
前 10 個最佳角度（按空白率排序）
================================================================================
排名    角度        掃描線      空白線      空白率        白色點率
--------------------------------------------------------------------------------
1     -11.0° ✅   1,265      562        44.43%        97.71%
2     -12.0°      1,271      559        43.98%        97.70%
3     -10.0°      1,258      551        43.79%        97.73%
4     -13.0°      1,278      555        43.43%        97.68%
5      -9.0°      1,251      542        43.33%        97.74%
6     -14.0°      1,285      556        43.27%        97.67%
7      -8.0°      1,243      537        43.20%        97.76%
8     -15.0°      1,293      558        43.15%        97.65%
9      -7.0°      1,236      533        43.12%        97.77%
10    -16.0°      1,300      560        43.08%        97.64%

最佳角度: -11.0° (空白率 44.43%)
================================================================================
```

## 工作原理

1. **角度掃描**: 遍歷指定範圍內的所有角度
2. **Bresenham 掃描**: 對每個角度，使用 Bresenham 演算法生成精確的掃描線
3. **空白檢測**: 計算每條掃描線上白色像素的比例，超過 90% 視為空白線
4. **統計分析**: 計算每個角度的空白率和白色點率
5. **結果排序**: 按空白率排序，找出最佳角度

## 性能優化建議

- **粗掃描**: 先用較大的 `--angle-step`（如 5°）和 `--scan-step`（如 10）快速找到大致範圍
- **精細掃描**: 在找到的範圍附近使用較小的 `--angle-step`（如 0.1°）和 `--scan-step`（如 1）精確定位
- **範圍限制**: 如果已知大致角度，使用 `--angle-start` 和 `--angle-end` 限制掃描範圍

## 範例工作流程

```bash
# 步驟 1: 粗掃描，快速找到大致範圍
python3 full_angle_scan.py --input ../fuji3.png --angle-step 5 --scan-step 10

# 假設發現最佳角度在 -15° 附近

# 步驟 2: 精細掃描，精確定位
python3 full_angle_scan.py --input ../fuji3.png --angle-start -20 --angle-end -5 --angle-step 0.1 --scan-step 1 --visualize

# 步驟 3: 查看可視化結果
# 輸出檔案: best_angle.jpg
```

## 與其他工具的比較

| 工具 | 用途 | 優點 | 缺點 |
|------|------|------|------|
| `preprocess_hough.py` | 使用 Hough 變換檢測角度 | 快速，基於現有線條特徵 | 依賴圖像中的線條 |
| `full_angle_scan.py` | 全角度暴力掃描 | 不依賴線條特徵，更準確 | 較慢（需測試所有角度） |

## 注意事項

- 全角度掃描較耗時，建議先用粗掃描確定範圍
- `--scan-step` 越小越精確，但速度越慢
- `--angle-step` 越小越精確，但測試角度數越多
- 對於 180° 範圍掃描，建議 `--angle-step` 不小於 0.5°
